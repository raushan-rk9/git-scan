# Ensure a proper .env file has been created before running.
# Bring up with docker-compose up --build -d
# Remove with docker-compose stop; docker-compose rm -f
# Get container logs with docker-compose logs -f

version: '3'
services:
# TODO: Add volume for postgres, https://docs.docker.com/compose/compose-file/#volume-configuration-reference
  db:
    image: postgres
    restart: always
    environment:
      - "POSTGRES_PASSWORD=${DBPASSWD}"
      - "POSTGRES_USER=${DBUSER}"
      - "POSTGRES_DB=${DBNAME}"
  cms:
    build: .
    environment:
      # This variable defines whether we are in the development or production environment.
      - RAILS_ENV
      # This sets the database user (DBUSER) and database name (DBNAME), and database password.
      - DBNAME
      - DBUSER
      - DBPASSWD
      - AIRWORTHINESS_CERTIFICATION_SERVICES_DBNAME
      - AIRWORTHINESS_CERTIFICATION_SERVICES_DBUSER
      - AIRWORTHINESS_CERTIFICATION_SERVICES_DBPASSWD
      - AIRWORTHINESS_CERTIFICATION_SERVICES_DBHOST
      - PATMOS_ENGINEERING_SERVICES_DBNAME
      - PATMOS_ENGINEERING_SERVICES_DBUSER
      - PATMOS_ENGINEERING_SERVICES_DBPASSWD
      - CIES_DBNAME
      - CIES_DBUSER
      - CIES_DBPASSWD
      - ABACO_DBNAME
      - ABACO_DBUSER
      - ABACO_DBPASSWD
      # Variables to define names for the tool.
      - SYSNAME
      - SYSACR
      - INSTANCENAME
    ports:
      - "62100:80"
      - "62101:443"
    volumes:
      - "${WEB_FILES}:/app"
    restart: always
    links:
      - db
