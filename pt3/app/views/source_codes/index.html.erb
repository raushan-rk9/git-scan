  <style>
  table.dataTable thead .sorting_asc:before,
  table.dataTable thead .sorting_asc:before,
  table.dataTable thead .sorting_asc:before,
  table.dataTable thead .sorting_asc:before,
  table.dataTable thead .sorting_asc:before,
  table.dataTable thead .sorting_asc:before,
  table.dataTable thead .sorting_asc:before,
  table.dataTable thead .sorting_asc:before,
  table.dataTable thead .sorting_asc:before,
  table.dataTable thead .sorting_asc:before,
  table.dataTable thead .sorting_asc:before,
  table.dataTable thead .sorting_asc:before {}
  
  table th
  {
    font-family: verdana !important;
    font-size:   14px    !important;
    line-height: 18px    !important;
  }
  
  table td
  {
    font-family: verdana !important;
    font-size:   14px    !important;
    line-height: 18px    !important;
  }
  </style>
  <h1><%= "#{t('misc.source_code')} #{t('misc.list')}" %></h1>
  
  <form name="filter" id="filter" class="filter-form" action="<%= item_source_codes_path(@item) %>"  method="put">
    <div class="filter-form" >
      Field:
      &nbsp;
      <select id="filter_field" name="filter_field" style="width: 25%;">
        <option value="full_id"><%= t('sourcecodes.codeid') %></option>
        <option value="description"><%= t('misc.desc') %></option>
        <option value="file_name"><%= t('misc.filename') %></option>
        <option value="function"><%= t('sourcecodes.function') %></option>
        <option value="derived">Derived</option>
        <option value="external_version"><%= t('versioning.external_version') %></option>
        <option value="version">Version</option>
        <option value="module_description_associations"><%= t('module_description.pl_title') %></option>
        <option value="derived_justification">Derived Justification</option>
        <option value="url_type">URL Type</option>
        <option value="url_link"><%= t('misc.url') %></option>
        <option value="url_description">URL Description</option>
      </select>
      &nbsp;
      Value:
      &nbsp;
      <input id="filter_value" name="filter_value" value='<%= session[:sc_filter_value] %>' type="text" style="width: 25%;">
      &nbsp;
      <input type="submit" value="Filter" style="width: 25%;" class="btn-sm" style="height: 50% !important;" >
    </div>
  </form>
  
  <table id="scrollableDataTable" class="table table-striped table-bordered table-sm" cellspacing="0"  width="100%">
    <thead>
      <tr>
        <th class="th-sm"><%= t('sourcecodes.codeid') %></th>
        <th class="th-sm"><%= t('misc.desc') %></th>
        <th class="th-sm"><%= t('sourcecodes.filename') %></th>
        <th class="th-sm"><%= t('misc.url') %></th>
        <th class="th-sm"><%= t('sourcecodes.function') %></th>
        <th class="th-sm"><%= t('module_description.pl_title') %></th>
        <th class="th-sm"><%= t('versioning.external_version') %></th>
        <th class="th-sm"><%= t('versioning.versionid') %></th>
        <th class="th-sm"></th>
        <th class="th-sm"></th>
        <th class="th-sm"></th>
        <th class="th-sm"></th>
      </tr>
    </thead>
  
    <tbody>
      <% @source_codes.each do |source_code| %>
        <% if source_code.soft_delete %>
          <tr>
            <td style='text-decoration: line-through;' ><%= source_code.codeid %></td>
            <td style='text-decoration: line-through;' ><%= raw source_code.description %></td>
            <td style="text-decoration: line-through; max-width: 200px !important; word-wrap: break-word !important;">
              <% if source_code.url_type.present? && source_code.url_link.present? %>
                <%= link_to source_code.url_link, ReviewAttachment.get_attachment_url(source_code, 'display') + '?new_window=true', target: :_blank %>
              <% else %>
                <%= File.Basename(source_code.file_name) %>
              <% end %>
            </td>
            <td style="text-decoration: line-through; max-width: 600px !important; word-wrap: break-word !important; font-size: 8px !important; line-height: 10px !important;">
              <%= link_to source_code.url_link, source_code.url_link, target: :_blank %>
            </td>
            <td style="text-decoration: line-through; max-width: 600px !important; word-wrap: break-word !important; font-size: 8px !important; line-height: 10px !important;">
              <%= raw source_code.function %>
            </td>
            <td style='text-decoration: line-through;' >
              <% if source_code.module_descriptions.present? %>
                <% source_code.module_descriptions.each do |md| %>
                  <%= link_to md.full_id, item_module_descriptions_path(@item, md.id) + '?new_window=true', target: :_blank %><br>
                <% end %>
              <% end %>
            </td>
            <td class="td-centered" style='text-decoration: line-through;' ><%= source_code.external_version %></td>
            <td class="td-centered" style='text-decoration: line-through;' ><%= source_code.version %></td>
            <td class="td-centered" style='text-decoration: line-through;' >
            </td>
            <td class="td-centered" style='text-decoration: line-through;' >
            </td>
            <td class="td-centered" style='text-decoration: line-through;' >
            </td>
            <td class="td-centered">
              <% if policy(source_code).destroy? %>
                <%= link_to [@item, source_code], method: :delete, data: { confirm: 'Are you sure?' } do %>
                   <%= material_icon.delete.md_24 %><br>Delete
                <% end %>
              <% else %>
                &nbsp;
              <% end %>
            </td>
          </tr>
        <% else %>
          <tr>
            <% if    policy(source_code).edit? && !session[:archives_visible].present? %>
              <td><%= link_to source_code.codeid, edit_item_source_code_path(@item, source_code)  + '?new_window=true', target: :_blank %></td>
            <% elsif policy(source_code).show? && !session[:archives_visible].present? %>
              <td><%= link_to source_code.codeid, item_source_code_path(@item, source_code)  + '?new_window=true', target: :_blank %></td>
            <% else %>
              <td><%= source_code.codeid %></td>
            <% end %>
            <td><%= raw source_code.description %></td>
            <td style="max-width: 200px !important; word-wrap: break-word !important;">
              <% if source_code.url_type.present? && source_code.url_link.present? %>
                <%= link_to source_code.url_link, ReviewAttachment.get_attachment_url(source_code, 'display') + '?new_window=true', target: :_blank %>
              <% else %>
                <%= File.basename(source_code.file_name) %>
              <% end %>
            </td>
            <td style="max-width: 600px !important; word-wrap: break-word !important; font-size: 8px !important; line-height: 10px !important;">
              <%= link_to source_code.url_link, source_code.url_link, target: :_blank %>
            </td>
            <td>
              <%= raw source_code.function %>
            </td>
            <td>
              <% if source_code.module_descriptions.present? %>
                <% source_code.module_descriptions.each do |md| %>
                  <%= link_to md.full_id, item_module_descriptions_path(@item, md.id) + '?new_window=true', target: :_blank %><br>
                <% end %>
              <% end %>
            </td>
            <td class="td-centered"><%= source_code.external_version %></td>
            <td class="td-centered"><%= source_code.version %></td>
            <td class="td-centered">
              <% if policy(source_code).show? %>
                <%= link_to item_source_code_path(@item, source_code) do %>
                  <%= material_icon.zoom_in.md_24 %><br>Show
                <% end %>
              <% else %>
                &nbsp;
              <% end %>
            </td>
            <td class="td-centered">
              <% if policy(source_code).edit? && !session[:archives_visible].present? %>
                <%= link_to [:edit, @item, source_code] do %>
                  <%= material_icon.edit.md_24 %><br>Edit
                <% end %>
              <% else %>
                &nbsp;
              <% end %>
            </td>
            <td class="td-centered">
              <% if policy(source_code).destroy? && !session[:archives_visible].present? %>
                <%= link_to item_source_code_mark_as_deleted_path(@item, source_code), data: { confirm: 'Are you sure?' } do %>
                  <%= material_icon.delete.md_24 %><br>Mark As Deleted
                <% end %>
              <% else %>
                &nbsp;
              <% end %>
            </td>
            <td class="td-centered">
              <% if policy(source_code).destroy? && !session[:archives_visible].present? %>
                <%= link_to [@item, source_code], method: :delete, data: { confirm: 'Are you sure?' } do %>
                   <%= material_icon.delete.md_24 %><br>Delete
                <% end %>
              <% else %>
                &nbsp;
              <% end %>
            </td>
          </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>
  
  <br>
  
  <% unless session[:archives_visible].present? %>
    <%= link_to 'New',             new_item_source_code_path(@item),                                           class: "btn" %>
  <% end %>
  
  <%= link_to 'Export',          item_source_codes_export_path(@item) + '?new_window=true', target: :_blank, class: "btn" %>
  
  <% unless session[:archives_visible].present? %>
    <%= link_to 'Import',          item_source_codes_import_path(@item),                                       class: "btn" %>
    <%= link_to "Scan GitHub",     item_source_codes_scan_github_path,                                         class: "btn" %>
    <%= link_to "Scan GitLab",     item_source_codes_scan_gitlab_path,                                         class: "btn" %>
    <%= link_to 'Renumber',        item_source_codes_renumber_path(@item),                                     class: "btn", data: { confirm: 'Are you sure?' } %>
    <%= link_to 'Analyze',         item_source_codes_analyze_path(@item),                                      class: "btn" %>
    <%= link_to 'View Analysis',   item_source_codes_analysis_path(@item),                                     class: "btn" %>
    <%= link_to 'Set Up Coverage', item_source_codes_instrument_path(@item),                                   class: "btn" %>
    <%= link_to 'Process',         item_source_codes_process_results_path(@item),                              class: "btn" %>
    <%= link_to 'Profile',         item_source_codes_profile_path(@item),                                      class: "btn" %>
    <%= link_to 'New Baseline',    new_project_requirements_baseline_path(@project, item_id: @item.id, archive_type: Constants::SOURCE_CODE_ARCHIVE), class: 'btn' %>
    <%= link_to 'View Baselines',  project_requirements_baselines_path(@project, item_id: @item.id, archive_type: Constants::SOURCE_CODE_ARCHIVE), class: 'btn' %>
    <%= link_to "Zip #{t('misc.source_code')}", item_source_codes_zip_path(@item), class: "btn" %>
  <% end %>
  
  <%= link_to 'Back', go_back_path(1),  onclick: 'validateBack(1, this)', class: 'btn' %>
  
  <% if @undo_path.present? && !session[:archives_visible].present? %>
    <%= link_to 'Undo', @undo_path, class: 'btn btn-default', title: @undo_message %>
  <% end %>
  
  <% if @redo_path.present? && !session[:archives_visible].present? %>
    <%= link_to 'Redo', @redo_path, class: 'btn btn-default', title: @redo_message %>
  <% end %>
  
  <script>
    if (document.cookie.match(/scrollTop=(\d+)/))
      $(window).scrollTop(document.cookie.match(/scrollTop=(\d+)/)[1]);

    $(document).ready
    (
      function()
      {
        var first     = true;
        var sortOrder = '[0, "asc"]';
  
        if (Cookies.get("source_codes_table_order"))
          sortOrder = Cookies.get("source_codes_table_order")
      
        if (document.cookie.match(/scrollTop=(\d+)/))
          $(window).scrollTop(document.cookie.match(/scrollTop=(\d+)/)[1]);
  
        $('#scrollableDataTable').DataTable
        (
          {
            "sDom":           "Rlfrtip",
            "scrollX":        true,
            "scrollY":        "55vh",
            "aLengthMenu":    [[10, 50, 100, -1], [25, 50, 100, "All"]],
            "pageLength":     -1,
            "scrollCollapse": true,
            "paging":         false,
            "ordering":       true,
            "info":           false,
            "sDom":           "Rlfrtip",
            "scrollY":        "55vh",
            "aLengthMenu":    [[10, 50, 100, -1], [25, 50, 100, "All"]],
            "pageLength":     -1,
            "scrollCollapse": true,
            "paging":         false,
            "ordering":       true,
            "info":           false,
            "drawCallback":   function(settings)
                              {
                                get_order(!first);
                              },
            "order":          JSON.parse(sortOrder)
          }
         );
  
        $('[name=filter_field]').val('<%= session[:sc_filter_field] %>');
        $(window).unload(function() {document.cookie = "scrollTop=" + $(window).scrollTop();});
  
        var tableOrder  = Cookies.get("source_codes_table_order");
  
        function get_order(force)
        {
          if (!Cookies.get("source_codes_table_order") || force)
          {
            var table   = $('#scrollableDataTable').DataTable();
            var date    = new Date();
            var minutes = 30;
  
            first       = false;
  
            date.setTime(date.getTime() + (minutes * 60 * 1000));
            Cookies.set('source_codes_table_order', table.order(), { expires: date });
  
            return table.order();      
          }
          else
          {
            first       = false;
  
            return Cookies.get("source_codes_table_order") ;
          }
        }
      }
    );
</script>
