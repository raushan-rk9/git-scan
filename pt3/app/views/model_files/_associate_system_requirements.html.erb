<style> 
  input[type="radio"], input[type="checkbox"]
  {
    padding-top: 10px !important;
    width: 20px       !important; 
    height: 20px      !important; 
  } 

  .system_requirement_all
  {
    width: 20px !important;
  }

  .idColumn
  {
     width: 20%            !important;
     align-content: center !important;
     text-align:    left   !important;
  }

  .descriptionColumn
  {
     width: 65%            !important;
     align-content: center !important;
     text-align:    left   !important;
  }

  .verificationMethodColumn
  {
     width: 10%            !important;
     align-content: center !important;
     text-align:    left   !important;
  }

  table.systemRequirementsDataTable thead th
  {
     height: 0px         !important;
     vertical-align: top !important;
  }

  table.systemRequirementsDataTable tbody td
  {
     height: 0px         !important;
     vertical-align: top !important;
  }
</style>

<h5>Link <%= t('misc.system_requirements') %></h5>

<table id="systemRequirementsTable" class="table table-striped table-bordered table-sm" cellspacing="0"  width="100%">
  <thead>
    <tr>
      <th class="system_requirement_all"><input :select_system_requirement_all, { type="checkbox", id="select_system_requirement_all", value="ALL"}>&nbsp;</th>
      <th scope="col" class="idColumn"><%=t('requirements.id') %></th>
      <th scope="col" class="descriptionColumn"><%= t('misc.desc') %></th>
      <th scope="col" class="verificationMethodColumn"><%= t('misc.verification_method') %></th>
    </tr>
  </thead>

  <tbody>
    <% if @system_requirements.present? %>
      <% @system_requirements.each do |system_requirement| %>
        <tr>
          <% if system_requirement.selected %>
            <td class="system_requirement_all">&nbsp;&nbsp;<input id='system_requirement.<%= system_requirement.id %>'name='system_requirement.<%= system_requirement.id %>' type="checkbox" checked value="<%= system_requirement.id %>" /></td>
          <% else %>
            <td class="system_requirement_all">&nbsp;&nbsp;<input id='system_requirement.<%= system_requirement.id %>' name='system_requirement.<%= system_requirement.id %>' type="checkbox" value="<%= system_requirement.id %>"/></td>
          <% end %>
          <td class="idColumn"><%= system_requirement.fullreqid %></td>
          <td class="descriptionColumn"><%= raw system_requirement.description %></td>
          <td class="verificationMethodColumn">
            <% if system_requirement.verification_method.instance_of?(Array) %>
              <%= system_requirement.verification_method.delete_if{ |x| !x.present? }.join(', ') %>
            <% elsif system_requirement.verification_method.instance_of?(String) %>
              <%= system_requirement.verification_method %>
            <% end %>
          </td>
        </tr>
      <% end %>
    <% end %>
  </tbody>
</table>

<br>
<input type='button' value='Save <%= t('misc.system_requirement') %> Links' style='display: none' onclick='submitSystemRequirements();' class='btn' />
<br>

<script>
var systemRequirementsDataTable = $('#systemRequirementsTable').DataTable({
	"sDom":           "Rlfrtip",
  "scrollX":        true,
  "scrollY":        "65vh",
  "aLengthMenu":    [[10, 50, 100, -1], [25, 50, 100, "All"]],
  "pageLength":     -1,
  "scrollCollapse": true,
  "paging":         false,
  "ordering":       false,
  "info":           false
});

function redraw()
{
  systemRequirementsDataTable.draw();
}

$("#select_system_requirement_all").change(function()
{
  var checked = false;

  if (document.getElementById("select_system_requirement_all").checked)
    checked = true;
  else
    checked = false;

  $("td.system_requirement_all input[type=checkbox]").prop('checked', checked);
});

function submitSystemRequirements()
{
  var selectedField                               = document.getElementById("model_file_system_requirement_associations");
  var linkedSystemRequirementsDiv                 = document.getElementById('linked_system_requirements');
  var linkedSystemRequirementsbutton              = document.getElementById('link_system_requirements_button');
  var linkedHighLevelRequirementsbutton           = document.getElementById('link_high_level_requirements_button');
  var linkedLowLevelRequirementsbutton            = document.getElementById('link_low_level_requirements_button');
  var linkedTestCasesbutton                       = document.getElementById('link_test_cases_button');
  var selected                                    = "";

  $('[id*="system_requirement."]').each(function(){
    if ($(this).prop('checked'))
    {
      var value = $(this).prop('value');

      if (value !== "ALL") {
        if (selected !== "")
          selected += "," + value;
        else
          selected = value;
      }
    }
  });

  selectedField.value = selected;

  linkedSystemRequirementsDiv.style.display       = 'none';

<% if @item.present? %>
  linkedSystemRequirementsbutton.style.display    = 'block';
  linkedHighLevelRequirementsbutton.style.display = 'block';
  linkedLowLevelRequirementsbutton.style.display  = 'block';
  linkedTestCasesbutton.style.display             = 'block';
<% end %>

  linkedSystemRequirementsbutton.value            = "Link <%= t('misc.system_requirements') %>";

  return(true);
}
</script>
