<ul class="list-group">
  <li class="list-group-item active">
    <h5>Problem Report ID: <%= @problem_report.fullprid %></h5>
  </li>
  <li class="list-group-item">
    <h6><u><%= t('misc.detail') %>:</u></h6>

    <p>
      <strong><%= t('problemreports.title') %>:</strong>
      <%= @problem_report.title %>
    </p>

    <p>
      <strong>Referenced Artifacts:</strong>
      <div style="padding-left: 50px">

        <% if @problem_report.referenced_artifacts['documents'].present? %>
          Documents:<br>
          <div style="padding-left: 50px">
            <% @problem_report.referenced_artifacts['documents'].each do |document_id| %>
              <%= link_to Document.item_name_and_name_from_id(document_id),
                          document_url(document_id, new_window: true ),
                          target: '_blank'
               %><br>
            <% end %>
          </div>
        <% end %>

        <% if @problem_report.referenced_artifacts['source_codes'].present? %>
          Source Code:<br>

          <div style="padding-left: 50px">
            <% @problem_report.referenced_artifacts['source_codes'].each do |source_code_id| %>
              <%= link_to SourceCode.item_name_and_code_id_plus_filename_from_id(source_code_id),
                          item_source_code_url(SourceCode.item_id_from_id(source_code_id),
                                               source_code_id, new_window: true),
                          target: '_blank'
               %><br>
            <% end %>
          </div>
        <% end %>

        <% if @problem_report.referenced_artifacts['test_procedures'].present? %>
          Test Procedures:<br>

          <div style="padding-left: 50px">
            <% @problem_report.referenced_artifacts['test_procedures'].each do |test_procedure_id| %>
              <%= link_to TestProcedure.item_name_and_procedure_id_plus_filename_from_id(test_procedure_id),
                          item_test_procedure_url(TestProcedure.item_name_and_procedure_id_plus_filename_from_id(test_procedure_id),
                                                  test_procedure_id, new_window: true),
                          target: '_blank'
               %><br>
            <% end %>
          </div>
        <% end %>

        <% if @problem_report.referenced_artifacts['other'].present? %>
          Other:<br>

          <div style="padding-left: 50px">
            <% @problem_report.referenced_artifacts['other'].each do |other| %>
              <%= other %><br>
            <% end %>
          </div>
        <% end %>
      </div>
    </p>

    <p>
      <strong>
        <%= t('problemreports.dateopened') %>:
      </strong>
      <%= @problem_report.dateopened %>
    </p>

    <p>
      <strong>
        <%= t('problemreports.openedby') %>:
      </strong>
      <%= User.fullname_from_email(@problem_report.openedby) %>
    </p>

    <p>
      <strong>
        <%= t('problemreports.status') %>:
      </strong>
      <%= @problem_report.status %>
    </p>

    <p>
      <strong>
        <%= t('problemreports.datemodified') %>:
      </strong>
      <%= @problem_report.datemodified %>
    </p>

    <p>
      <strong>
        <%= t('problemreports.product') %>:
      </strong>
      <%= @problem_report.product %>
    </p>

    <p>
      <strong>
        <%= t('problemreports.criticality') %>:
      </strong>
      <%= @problem_report.criticality %>
    </p>

    <p>
      <strong>
        <%= t('problemreports.source') %>:
      </strong>
      <%= @problem_report.source %>
    </p>

    <p>
      <strong>
        <%= t('problemreports.discipline_assigned') %>:
      </strong>
      <%= @problem_report.discipline_assigned %>
    </p>

    <p>
      <strong>
        <%= t('problemreports.assignedto') %>:
      </strong>
      <%= User.fullname_from_email(@problem_report.assignedto) %>
    </p>

    <p>
      <strong>
        <%= t('problemreports.target_date') %>:
      </strong>
      <%= @problem_report.target_date %>
    </p>

    <p>
      <strong>
        <%= t('problemreports.close_date') %>:
      </strong>
      <%= @problem_report.close_date %>
    </p>

    <p>
      <strong>
        <%= t('problemreports.description') %>:
      </strong>
      <%= simple_format(@problem_report.description) %>
    </p>

    <p>
      <strong>
        <%= t('problemreports.problemfoundin') %>:
      </strong>
      <%= @problem_report.problemfoundin %>
    </p>

    <p>
      <strong>
        <%= t('problemreports.correctiveaction') %>:
      </strong>
      <%= simple_format(@problem_report.feedback) %>
    </p>

    <p>
      <strong>
        <%= t('problemreports.fixed_in') %>:
      </strong>
      <%= @problem_report.fixed_in %>
    </p>

    <p>
      <strong>
        <%= t('problemreports.verification') %>:
      </strong>
      <%= simple_format(@problem_report.notes) %>
    </p>

    <p>
      <strong>
        <%= t('problemreports.meeting_id') %>:
      </strong>
      <%= @problem_report.meeting_id %>
    </p>

    <p>
      <strong>
        <%= t('problemreports.safetyrelated') %>:
      </strong>
      <%= @problem_report.safetyrelated %>
    </p>

    <p>
      <strong><%= t('problemreports.history') %>:</strong>
      <%= link_to "View", problem_report_problem_report_histories_path(@problem_report) %>
    </p>

    <p>
      <strong>Files:</strong>
      <br>
      <table class="table">
        <thead>
          <tr>
            <th scope="col">File</th>
            <th scope="col">Uploaded</th>
            <th colspan="3"></th>
          </tr>
        </thead>
        <tbody>
          <% @problem_report.problem_report_attachment.each do |prattach| %>
            <% if prattach.link_type.present? && prattach.link_link.present? %>
              <tr>
                <td>
                  <% if prattach.link_type == 'ATTACHMENT' && prattach.file.attached?  %>
                    <%= link_to prattach.file.filename, url_for(prattach.file) + '?new_window=true', target: :_blank %>
                  <% else %>
                    <% description = prattach.link_description %>

                    <% unless description.present? %>
                      <% description = prattach.link_link %>
                    <% end %>

                    <% if prattach.link_link =~ /^http[s]{0,1}:\/\/.+$/ %>
                      <%= link_to description, prattach.link_link + '?new_window=true', target: :_blank %>
                    <% else %>
                      <%= description %>
                    <% end %>
                  <% end %>
                </td>
                <td>
                  <%= prattach.upload_date %>
                </td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
      <br>
    </p>
  </li>
</ul>

<%= link_to 'Edit', [:edit, @project, @problem_report],     class: 'btn'  %>
<%= link_to 'New Problem Report', new_project_problem_report_path(@project), class: "btn" %>
<%= link_to 'Email Problem Report', project_problem_report_email_problem_report_path(@project, @problem_report), class: "btn" %>
<%= link_to 'Back', go_back_path(1),  onclick: 'validateBack(1, this)', class: 'btn' %>

<% if @undo_path.present? && !session[:archives_visible].present? %>
  <%= link_to 'Undo', @undo_path, class: 'btn btn-default', title: @undo_message %>
<% end %>

<% if @redo_path.present? && !session[:archives_visible].present? %>
  <%= link_to 'Redo', @redo_path, class: 'btn btn-default', title: @redo_message %>
<% end %>

