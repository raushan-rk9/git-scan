<style>
table.dataTable thead .sorting_asc:before,
table.dataTable thead .sorting_asc:before,
table.dataTable thead .sorting_asc:before,
table.dataTable thead .sorting_asc:before,
table.dataTable thead .sorting_asc:before,
table.dataTable thead .sorting_asc:before,
table.dataTable thead .sorting_asc:before,
table.dataTable thead .sorting_asc:before {}

table th
{
  font-family: verdana !important;
  font-size:   14px    !important;
  line-height: 18px    !important;
}

table td
{
  font-family: verdana !important;
  font-size:   14px    !important;
  line-height: 18px    !important;
}
</style>

<h1>Users <%= t('misc.list') %></h1>

<table id="scrollableDataTable" class="table table-striped table-bordered table-sm" cellspacing="0"  width="100%">
  <thead>
    <tr>
      <th class="th-sm">Email</th>
      <th class="th-sm">Sign In Count</th>
      <th class="th-sm">Last Sign In</th>
      <th class="th-sm">Name</th>
      <th class="th-sm">Roles</th>
      <th class="th-sm">Organization</th>
      <th class="th-sm"></th>
      <th class="th-sm"></th>
      <th class="th-sm"></th>
    </tr>
  </thead>

  <tbody>
    <% @users.each do |user| %>
      <tr>
        <td><%= user.email %></td>
        <td><%= user.sign_in_count %></td>
        <td><%= user.last_sign_in_at.strftime("%Y-%m-%d") if user.last_sign_in_at != nil  %></td>
        <td><%= user.fullname %></td>
        <td><%= user.role.compact.reject(&:empty?).join(', ') %>
        <td><%= user.organization %></td>
        <td class="td-centered">
          <% if policy(user).show? %>
            <%= link_to user_path(user) do %>
              <%= material_icon.zoom_in.md_24 %>Show
            <% end %>
          <% else %>
            &nbsp;
          <% end %>
        </td>
        <td class="td-centered">
          <% if policy(user).edit? %>
            <%= link_to [:edit, user] do %>
              <%= material_icon.edit.md_24 %>Edit
            <% end %>
          <% else %>
            &nbsp;
          <% end %>
        </td>
        <td class="td-centered">
          <% if policy(user).destroy? %>
            <%= link_to [user], method: :delete, data: { confirm: 'Are you sure?' } do %>
              <%= material_icon.delete.md_24 %>Delete
            <% end %>
          <% else %>
            &nbsp;
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New User', new_user_path, class: "btn btn-primary" %>
<%= link_to 'Back', go_back_path(1),  onclick: 'validateBack(1, this)', class: 'btn' %>

<script>
  $( document ).ready(function() {
    if (document.cookie.match(/scrollTop=(\d+)/))
      $(window).scrollTop(document.cookie.match(/scrollTop=(\d+)/)[1]);

    $('#scrollableDataTable').DataTable({
    "sDom":           "Rlfrtip",
    "scrollX":        true,
    "scrollY":        "55vh",
    "aLengthMenu":    [[10, 50, 100, -1], [25, 50, 100, "All"]],
    "pageLength":     -1,
    "scrollCollapse": true,
    "paging":         false,
    "ordering":       true,
    "info":           false,
    });
  });

  $(window).unload(function() {document.cookie = "scrollTop=" + $(window).scrollTop();});
</script>