<style>
     table.dataTable thead .sorting_asc:before,
     table.dataTable thead .sorting_asc:before,
     table.dataTable thead .sorting_asc:before,
     table.dataTable thead .sorting_asc:before,
     table.dataTable thead .sorting_asc:before,
     table.dataTable thead .sorting_asc:before,
     table.dataTable thead .sorting_asc:before {}
 </style>

<h1>
  <%= "#{t('misc.select')} #{t('misc.documents')} for Certification Package" %>
</h1>

<table id="scrollableDataTable" class="table table-striped table-bordered table-sm" cellspacing="0"  width="100%">
  <thead>
    <tr>
      <th class="all"><input :select_all, { type="checkbox", class="largerCheckbox", id="select_all", value="ALL"}>&nbsp;</th>
      <th scope="col", style='height: 100px; vertical-align:middle'><%= t('document.docid') %></th>
      <th scope="col", style='height: 100px; vertical-align:middle'><%= t('misc.name') %></th>
      <th scope="col", style='height: 100px; vertical-align:middle'><%= t('misc.crontrol_category') %></th>
      <th scope="col", style='height: 100px; vertical-align:middle'><%= t('versioning.revision') %></th>
      <th scope="col", style='height: 100px; vertical-align:middle'><%= t('document.revdate') %></th>
      <th scope="col", style='height: 100px; vertical-align:middle'>(Open/Closed) Comments</th>
    </tr>
  </thead>

  <tbody>
    <% @documents.each do |document| %>
      <%
        open_count   = DocumentComment.where(document_id: document.id, status: 'Open').count
        closed_count = DocumentComment.where(document_id: document.id, status: 'Closed').count
      %>

      <tr>
        <% if document.selected %>
          <td><input id=document.id name=document.id type="checkbox" class="largerCheckbox" checked value="<%= document.id %>" /></td>
        <% else %>
          <td><input id=document.id name=document.id type="checkbox" class="largerCheckbox" value="<%= document.id %>"/></td>
        <% end %>
        <td>
          <% if document.file.present? %>
            <%= link_to item_document_download_document_path(@item, document) do %>
              <% if document.file_path =~ /^.*\.pdf$/i %>
                <%= material_icon.picture_as_pdf.md_24 %>
              <% elsif document.file_path =~ /^.*\.(txt|doc|docx|odt)$/i %>
                <%= material_icon.description.md_24 %>
              <% elsif document.file_path =~ /^.*\.(xls|xlsx|csv|ods)$/i %>
                <%= material_icon.apps.md_24 %>
              <% elsif document.file_path =~ /^.*\.(jpg|jpeg|png|tiff|bmp|ico|svg)$/i %>
                <%= material_icon.insert_photo.md_24 %>
              <% elsif document.file_path =~ /^.*\.(jpg|jpeg|png|tiff|bmp|ico|svg)$/i %>
                <%= material_icon.insert_photo.md_24 %>
              <% elsif document.file_path =~ /^.*\.(vdx|vsd|vsdx)$/i %>
                <%= material_icon.usb.md_24.r180 %>
              <% elsif document.file_path =~ /^.*\.(ppt|pptx)$/i %>
                <%= material_icon.slideshow.md_24 %>
              <% elsif document.file_path =~ /^.*\.(mov|wmv|flv|avi|mp4)$/i %>
                <%= material_icon.movie.md_24 %>
              <% elsif document.file_path =~ /^.*\.(mp3|wav|aiff|wma)$/i %>
                <%= material_icon.music_note.md_24 %>
              <% elsif document.file_path =~ /^.*\.gif$/i %>
                <%= material_icon.gif.md_24 %>
              <% elsif document.file_path =~ /^.*\.(zip||gz|7z|tar)$/i %>
                <%= material_icon.archive.md_24 %>
              <% elsif document.file_path =~ /^.*\.html$/i %>
                <%= material_icon.http.md_24 %>
              <% elsif document.file_path =~ /^.*\.([ch]|cpp|c++|bat|sh|pl|java|rb|js|php|yml|erb)$/i %>
                <%= material_icon.code.md_24 %>
              <% else %>
                <%= material_icon.help.md_24 %>
              <% end %>
              <%= document.docid %>
            <% end %>
          <% else %>
            <%= document.docid %>
          <% end %>
        </td>

        <td><%= document.name %></td>

        <% if Constants::ControlCategory.invert[document.category].nil? && document.category.present? %>
          <td><%= document.category %></td>
        <% else %>
          <td><%= Constants::ControlCategory.invert[document.category] %></td>
        <% end %>

        <td><%= document.revision %></td>
        <td><%= document.revdate %></td>
        <td><%= "(#{open_count}/#{closed_count}) Comments" %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<form id="selected_documents_form" novalidate="novalidate" enctype="multipart/form-data" action="<%= item_documents_package_documents_path(@item) %>" accept-charset="UTF-8" method="post">
Filename: 
<input name='selected_documents[filename]'   id='selected_documents_filename' value='<%= @item.name %>-documents.zip'/>
<input name='selected_documents[selections]' id='selected_documents_selections'  type='hidden' />
<br>
<input type='submit' value='Create Certification Package' onclick='submit_documents();' class='btn btn-primary' />
<%= link_to 'Back', go_back_path(1),  onclick: 'validateBack(1, this)', class: 'btn' %>
</form>

<br>

<script>
function submit_documents()
{
  var selectedField = document.getElementById("selected_documents_selections");
  var selected      = "";

  $("input[type=checkbox]").each(function(){
    if ($(this).prop('checked'))
    {
      var value = $(this).prop('value');

      if (value !== "ALL") {
        if (selected !== "")
          selected += "," + value;
        else
          selected = value;
      }
    }
  });

  selectedField.value = selected;

  return(true);
}

$( document ).ready(function() {
  if (document.cookie.match(/scrollTop=(\d+)/))
    $(window).scrollTop(document.cookie.match(/scrollTop=(\d+)/)[1]);

  $('#scrollableDataTable').DataTable({
  "sDom":           "Rlfrtip",
  "scrollX":        true,
  "scrollY":        "55vh",
  "aLengthMenu":    [[10, 50, 100, -1], [25, 50, 100, "All"]],
  "pageLength":     -1,
  "scrollCollapse": true,
  "paging":         false,
  "ordering":       true,
  "info":           false,
  });
});

$(window).unload(function() {document.cookie = "scrollTop=" + $(window).scrollTop();});

$("th.all").change(function()
{
  var checked = false;

  if (document.getElementById("select_all").checked)
    checked = true;
  else
    checked = false;

  $("input[type=checkbox]").prop('checked', checked);
});
</script>
