<%= simple_form_for( [@problem_report_attachment.problem_report, @problem_report_attachment], html: { class: 'form-horizontal' }) do |f| %>
  <%= f.error_notification %>

  <div class="form-inputs">
    <%= f.input :link_type, collection: Constants::AttachmentType_hash, include_blank: false, label: 'File Type'  %> 
    <label class="control-label select optional" id="label" ></label>
    <%= f.input :link_link, label: false %>
    <%= f.file_field :file %>
    <%= f.input :pact_file, collection: @pact_files, include_blank: true, label: false %> 
    <%= f.input :link_description, :as => :hidden %>

    <% if current_user.fulladmin && @problem_report_attachment.project_id.present? %>
      <%= f.association :problem_report, collection: ProblemReport.where(project_id: @problem_report_attachment.project_id), :label_method => :fullpr_with_title %>
    <% end %>

    <% if @problem_report_attachment.user.present? %>
      <%=
          f.input :user,
                  label:        'Created By',
                  collection:    User.organization_or_role(current_user.organization,
                                                           'AirWorthinessCert Member'),
                  label_method: :fullname,
                  value_method: :email,
                  selected:      @problem_report_attachment.user
       %>
    <% else %>
      <%=
          f.input :user,
                  label:        'Created By',
                  collection:    User.organization_or_role(current_user.organization,
                                                           'AirWorthinessCert Member'),
                  label_method: :fullname,
                  value_method: :email,
                  selected:     @current_user.email
       %>
    <% end %>
  </div>

  <div class="form-actions">
    <%= f.button :submit, data: { "disable-with": t('misc.save') } %>

    <% if @problem_report_attachment.id.present? %>
      <%= link_to 'Show', problem_report_problem_report_attachment_path(@problem_report, @problem_report_attachment), class: 'btn btn-default' %>
    <% end %>

    <% if controller.action_name == 'edit' %>
      <%= link_to 'New Problem Report Attachment', new_problem_report_problem_report_attachment_path(@problem_report), class: 'btn btn-default'  %>
    <% end %>

    <%= link_to 'Back', 'javascript:null', class: "btn", onclick: 'validateBack(1)' %>

    <% if @undo_path.present? && !session[:archives_visible].present? %>
      <%= link_to 'Undo', @undo_path, class: 'btn btn-default', title: @undo_message %>
    <% end %>

    <% if @redo_path.present? && !session[:archives_visible].present? %>
      <%= link_to 'Redo', @redo_path, class: 'btn btn-default', title: @redo_message %>
    <% end %>
  </div>
<% end %>

<script>
  var model            = "problem_report_attachment";
  var label            = "label";
  var link_type        = model + "_link_type";
  var link_description = model + "_link_description";
  var link_link        = model + "_link_link";
  var pact_file        = model + "_pact_file";
  var file             = model + "_file";
  var link_type_select = "#" + link_type;
  var pact_file_select = "#" + pact_file;

  function link_type_changed()
  {
      var link_description_field = document.getElementById(link_description);
      var link_link_field        = document.getElementById(link_link);
      var label_field            = document.getElementById(label);
      var pact_file_field        = document.getElementById(pact_file);
      var file_field             = document.getElementById(file);
      var link_type_value        = document.getElementById(link_type).value;

      if (link_type_value === "EXTERNAL")
      {
          label_field.innerHTML           = "URL";
          link_link_field.style.display   = "block";
          label_field.style.display       = "block";
          pact_file_field.style.display   = "none";
          file_field.style.display        = "none";
      }
      else if (link_type_value === "PACT")
      {
          label_field.innerHTML           = "PACT File";
          link_link_field.style.display   = "none";
          label_field.style.display       = "block";
          pact_file_field.style.display   = "block";
          file_field.style.display        = "none";
      }
      else if (link_type_value === "ATTACHMENT")
      {
          label_field.innerHTML           = "Attach File";
          link_link_field.style.display   = "none";
          label_field.style.display       = "block";
          pact_file_field.style.display   = "none";
          file_field.style.display        = "block";
      }
      else if (link_type_value === "")
      {
          label_field.innerHTML           = "";
          link_link_field.style.display   = "none";
          label_field.style.display       = "none";
          pact_file_field.style.display   = "none";
          file_field.style.display        = "none";
      }
  }

  function pact_file_changed()
  {
      var link_description_field   = document.getElementById(link_description);
      var pact_file_field          = document.getElementById(pact_file);
      var label                    = pact_file_field.options[pact_file_field.selectedIndex].label;

      link_description_field.value = label;
  }

  $(document).ready(function() {
    link_type_changed();

    $(pact_file_select).change(function()
    {
      pact_file_changed();
    });

    $(link_type_select).change(function()
    {
      link_type_changed();
    });
  });
</script>